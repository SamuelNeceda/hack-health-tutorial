import {Callout} from 'nextra-theme-docs'

### CORS

-> Comment out the line `app.use(cors());{:js}` in `server.ts` file and try to login to the HackHealth account.
-> As you can see, the login is not successful and if we open the Developer Tools -> Console, we get the message like:
<Callout type="error" emoji="ï¸ðŸš«">
    Access to fetch at 'http://localhost:5000/auth/verify' from origin 'http://localhost:3000' has been blocked by CORS
    policy:
    Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present
    on the requested resource...
</Callout>

When setting up web server, we included cors library and added the following line of code:
`app.use(cors());{:js}`
This action was deliberately left uncommented in the tutorial, because it is meant to show one important thing.
Even experienced software engineers sometimes just copy some parts of code and are generally not fully aware of the
consequences it can have on the application and its security.

In this case, the cors library is used to enable CORS (Cross-Origin Resource Sharing).
When a web browser tries to access resources on a different domain, it sends an HTTP request to the server hosting the
resource. If the server does not allow requests from that domain, the browser will block the response and the web
application will not be able to access the resource.

`app.use(cors());{:js}` allows requests from any domain, which is a security risk.
**Demo of the attack:**
1. Open Postman app
2. Create a new GET request to localhost:5000/api/users and set the header `Origin: http://evil.com`
3. Send a request
4. You should get a response with the list of all users

This was a demonstration that web app is vulnerable to CORS attack.

**Fix:**
1. Add the following variable to the file.
```js filename="jwtAuth.ts" {3} copy showLineNumbers
const options = {
   origin: 'http://localhost:3000'}
   ```
2. Pass the options object to the cors function.
`app.use(cors(options));{:js}`

**Recreate the attack:**
1. Send the same request as in the demo
2. You should get an error message
